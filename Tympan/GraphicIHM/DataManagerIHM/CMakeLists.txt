cmake_minimum_required(VERSION 2.8)
set(MODULE_NAME tympan_dm_ihm)

file(GLOB ${MODULE_NAME}_SOURCES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} *.cpp *.h *.hpp)

# cf. https://qt-project.org/quarterly/view/using_cmake_to_build_qt_projects

# Headers requiring MOC pre-processing...
file(GLOB ${MODULE_NAME}_MOC_HEADERS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} *.h )
# ... all in this directory but for the two below
list(REMOVE_ITEM ${MODULE_NAME}_MOC_HEADERS TYIncludesQT.h TYPHIHM.h)
# Call moc on the listed headers, thus generating new sources
qt4_wrap_cpp(${MODULE_NAME}_MOC_SOURCES ${${MODULE_NAME}_MOC_HEADERS})

# Qt Designer UIC files
file(GLOB ${MODULE_NAME}_FORMS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} *.ui )
# Call moc on the listed UI file, thus generating new sources
qt4_wrap_ui(${MODULE_NAME}_FORMS_HEADERS ${${MODULE_NAME}_FORMS})

#set_precompiled_header(${MODULE_NAME} CXX
#  ${CMAKE_CURRENT_SOURCE_DIR}/TYPHIHM.h ${MODULE_NAME}_PCH_SOURCES)

add_library(${MODULE_NAME} ${TYMPAN_COMPONENT_TYPE}
  ${${MODULE_NAME}_SOURCES}
  ${${MODULE_NAME}_PCH_SOURCES}
  ${${MODULE_NAME}_MOC_SOURCES} # Sources generated by MOC
  ${${MODULE_NAME}_FORMS_HEADERS} # Sources generated by UIC
  )
set_property(TARGET ${MODULE_NAME} PROPERTY FOLDER ${CURRENT_FOLDER})
#use_precompiled_header(${MODULE_NAME} ${MODULE_NAME}_SOURCES)
#add_dependencies(${MODULE_NAME}_pch ${MODULE_NAME}_FORMS_HEADERS)
add_dependencies(${MODULE_NAME} tympan_tools tympan_tools_graphics)

target_link_libraries(${MODULE_NAME} ${QT_LIBRARIES})

install_tympan_component(${MODULE_NAME})